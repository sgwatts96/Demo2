<project name="ANT Jobs" basedir="." xmlns:sf="antlib:com.salesforce">

	<!-- first load properties from the environemnt -->
	<property environment="env"/>

	<!-- second load properties from the build.properties file -->
	<property file="build.properties" />

	<!-- Load Resources -->
	<taskdef resource="com/salesforce/antlib.xml" uri="antlib:com.salesforce">
		<classpath>
			<pathelement location="./build/lib/ant-salesforce.jar" />
		</classpath>
	</taskdef>

	
	<taskdef resource="net/sf/antcontrib/antcontrib.properties">
		<classpath>
			<pathelement location="./build/lib/ant-contrib-1.0b2.jar"/>
		</classpath>
	</taskdef>

	<target name="deploy_setup_params">
		<input message="Salesforce username:" addproperty="sf.username" />
		<input message="Salesforce password (including security token):" addproperty="sf.password">
		    <handler type="secure" />
		</input>
		<property name="sf.serverurl" value="https://login.salesforce.com"/> <!-- default connect to sandbox environment--> 
		<property name="sf.token" value=""/> <!-- empty security token if not set earlier -->
		<property name="sf.org" value=""/> <!-- empty org / sandbox name if not set earlier -->
		<property name="sf.runAllTests" value="false"/> <!-- default to not run tests -->
		<property name="sf.ignoreWarnings" value="true" /> <!-- default to ignore warnings -->
	</target>

	<!-- setups deployment properties by asking for user/pass if needed -->
	<target name="deploy_setup" depends="deploy_setup_params">
		<echo message="================================================" />
		<echo message="Deploying to server URL: ${sf.serverurl}" />
		<echo message="Username: ${sf.username}" />
		<echo message="ORG: ${sf.org}" />
		<echo message="Ignore warnings: ${sf.ignoreWarnings}" />
		<echo message="Check Only: ${sf.checkOnly}" />
		<echo message="Test level: ${sf.testLevel}" />
		<echo message="================================================" />
	</target>

	<target name="deploy" description="deploys the source to specified sandbox" depends="deploy_setup">

		<sf:deploy
			username="${sf.username}${sf.org}"
			password="${sf.password}${sf.token}"
			serverurl="${sf.serverurl}"
			deployRoot="${src.dir}"
			maxPoll="${sf.maxPoll}"
			pollWaitMillis="${sf.pollWaitMillis}"
			testLevel="${sf.testLevel}"
			ignoreWarnings="${sf.ignoreWarnings}"
			checkOnly="${sf.checkOnly}"
		/>

	</target>

</project>
